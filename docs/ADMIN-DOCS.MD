Coletando informa√ß√µes do workspace# üîß M√≥dulo de Administra√ß√£o - Cooperescrita

## üìã Vis√£o Geral

O m√≥dulo de administra√ß√£o da Cooperescrita fornece funcionalidades completas para gerenciar usu√°rios, reda√ß√µes, corre√ß√µes e reports do sistema. Todas as rotas requerem autentica√ß√£o JWT e privil√©gios de administrador.

## üîë Autentica√ß√£o

Todas as requisi√ß√µes devem incluir o header:
```
Authorization: Bearer {access_token}
```

## üë• Gerenciamento de Usu√°rios

### Buscar Usu√°rio por Email
```http
GET /admin/users/find-by-email?email=usuario@exemplo.com
```

**Resposta**:
```json
{
  "id": "uuid",
  "name": "Nome do Usu√°rio",
  "email": "usuario@exemplo.com",
  "role": "user",
  "verified": true,
  "active": true
}
```

### Buscar Usu√°rio por Nome
```http
GET /admin/users/find-by-name?name=Jo√£o
```

### Listar Usu√°rios
```http
GET /admin/users/list?page=1&limit=10&search=silva&role=user
```

**Par√¢metros**:
- `page`: N√∫mero da p√°gina (padr√£o: 1)
- `limit`: Itens por p√°gina (padr√£o: 10)
- `search`: Buscar em nome e email
- `role`: Filtrar por `user` ou `admin`

**Resposta**:
```json
{
  "users": [
    {
      "id": "uuid",
      "name": "Nome",
      "email": "email@exemplo.com",
      "role": "user",
      "verified": true,
      "createdAt": "2023-01-01T00:00:00.000Z",
      "active": true
    }
  ],
  "meta": {
    "total": 50,
    "page": 1,
    "limit": 10,
    "totalPages": 5
  }
}
```

### Ativar/Desativar Usu√°rio
```http
POST /admin/users/{userId}/toggle-status
```

### Deletar Usu√°rio
```http
DELETE /admin/users/delete-by-email
Content-Type: application/json

{
  "email": "usuario@exemplo.com"
}
```

## üìù Gerenciamento de Reda√ß√µes

### Visualizar Reda√ß√£o
```http
GET /admin/redacoes/{id}
```

### Listar Reda√ß√µes
```http
GET /admin/redacoes?limit=20&offset=0&status=enviado&userId=uuid&search=tema
```

**Par√¢metros**:
- `limit`: Itens por p√°gina (padr√£o: 20)
- `offset`: Deslocamento (padr√£o: 0)
- `status`: `enviado` ou `rascunho`
- `userId`: Filtrar por autor
- `search`: Buscar em t√≠tulo e t√≥pico

### Deletar Reda√ß√£o
```http
DELETE /admin/redacoes/{id}
```

## ‚úèÔ∏è Gerenciamento de Corre√ß√µes

### Visualizar Corre√ß√£o
```http
GET /admin/correcoes/{id}
```

### Listar Corre√ß√µes
```http
GET /admin/correcoes?limit=20&offset=0&status=enviado&corretorId=uuid&redacaoId=123
```

**Par√¢metros**:
- `limit`: Itens por p√°gina (padr√£o: 20)
- `offset`: Deslocamento (padr√£o: 0)
- `status`: `enviado` ou `rascunho`
- `corretorId`: Filtrar por corretor
- `redacaoId`: Filtrar por reda√ß√£o

### Deletar Corre√ß√£o
```http
DELETE /admin/correcoes/{id}
```

## üö® Gerenciamento de Reports

### Listar Reports de Reda√ß√µes
```http
GET /admin/reports/redacoes?limit=20&offset=0&status=pendente&motivo=spam
```

### Listar Reports de Corre√ß√µes
```http
GET /admin/reports/correcoes?limit=20&offset=0&status=pendente&motivo=ofensivo
```

**Par√¢metros de Filtro**:
- `status`: `pendente`, `analisado`, `rejeitado`
- `motivo`: `conteudo_inadequado`, `spam`, `plagio`, `ofensivo`, `outro`
- `dataInicial`: Data inicial (ISO string)
- `dataFinal`: Data final (ISO string)

### Resolver Report de Reda√ß√£o
```http
PATCH /admin/reports/redacao/{reportId}/resolve
Content-Type: application/json

{
  "acao": "analisado",
  "observacoes": "Conte√∫do adequado ap√≥s an√°lise",
  "deletarConteudo": false
}
```

### Resolver Report de Corre√ß√£o
```http
PATCH /admin/reports/correcao/{reportId}/resolve
Content-Type: application/json

{
  "acao": "analisado",
  "observacoes": "Report v√°lido - conte√∫do removido",
  "deletarConteudo": true
}
```

### Estat√≠sticas de Reports
```http
GET /admin/reports/stats
```

**Resposta**:
```json
{
  "totalRedacaoReports": 45,
  "totalCorrecaoReports": 23,
  "pendingRedacaoReports": 12,
  "pendingCorrecaoReports": 8,
  "redacaoMotivos": [
    { "motivo": "spam", "count": "15" },
    { "motivo": "ofensivo", "count": "10" }
  ],
  "correcaoMotivos": [...],
  "redacaoTrend": [...],
  "correcaoTrend": [...]
}
```

## üîê Autentica√ß√£o de Admin

### Registrar Novo Admin
```http
POST /admin/auth/signup
Content-Type: application/json

{
  "name": "Admin Nome",
  "email": "admin@exemplo.com",
  "password": "SenhaSegura@123"
}
```

> **Nota**: Apenas administradores podem criar novas contas de administrador.

## üí° Guia para Frontend

### Estrutura de Estado Recomendada

```javascript
const adminState = {
  users: {
    list: [],
    total: 0,
    loading: false,
    filters: { page: 1, limit: 10, search: '', role: '' }
  },
  redacoes: {
    list: [],
    total: 0,
    loading: false,
    filters: { limit: 20, offset: 0, status: '', userId: '', search: '' }
  },
  correcoes: {
    list: [],
    total: 0,
    loading: false,
    filters: { limit: 20, offset: 0, status: '', corretorId: '', redacaoId: '' }
  },
  reports: {
    redacoes: [],
    correcoes: [],
    stats: {},
    loading: false,
    filters: { status: 'pendente', motivo: '' }
  }
};
```

### Tratamento de Erros

```javascript
async function handleAdminRequest(apiCall) {
  try {
    const response = await apiCall();
    return response.data;
  } catch (error) {
    if (error.response?.status === 403) {
      // Redirecionar para p√°gina de acesso negado
      router.push('/access-denied');
    } else if (error.response?.status === 404) {
      // Mostrar mensagem de "n√£o encontrado"
      toast.error('Item n√£o encontrado');
    } else {
      // Erro gen√©rico
      toast.error('Erro interno do servidor');
    }
    throw error;
  }
}
```

### Componente de Listagem Exemplo

```jsx
function AdminUsersList() {
  const [users, setUsers] = useState([]);
  const [filters, setFilters] = useState({ page: 1, limit: 10 });
  const [loading, setLoading] = useState(false);

  async function loadUsers() {
    setLoading(true);
    try {
      const data = await api.get('/admin/users/list', { params: filters });
      setUsers(data.users);
    } catch (error) {
      handleAdminRequest(() => Promise.reject(error));
    } finally {
      setLoading(false);
    }
  }

  async function toggleUserStatus(userId) {
    try {
      await api.post(`/admin/users/${userId}/toggle-status`);
      toast.success('Status alterado com sucesso');
      loadUsers(); // Recarregar lista
    } catch (error) {
      handleAdminRequest(() => Promise.reject(error));
    }
  }

  // ... resto do componente
}
```

### Resolu√ß√£o de Reports

```javascript
async function resolveReport(reportId, tipo, acao, observacoes, deletarConteudo) {
  const endpoint = tipo === 'redacao' 
    ? `/admin/reports/redacao/${reportId}/resolve`
    : `/admin/reports/correcao/${reportId}/resolve`;

  try {
    await api.patch(endpoint, {
      acao,
      observacoes,
      deletarConteudo
    });
    
    toast.success('Report resolvido com sucesso');
    // Recarregar lista de reports
    loadReports();
  } catch (error) {
    handleAdminRequest(() => Promise.reject(error));
  }
}
```

## ‚ö†Ô∏è Considera√ß√µes Importantes

1. **Rate Limiting**: Algumas opera√ß√µes t√™m limites de taxa (ex: 10 dele√ß√µes por 5 minutos)
2. **Logs**: Todas as a√ß√µes administrativas s√£o registradas nos logs do sistema
3. **Notifica√ß√µes**: Opera√ß√µes cr√≠ticas geram emails de notifica√ß√£o para o admin principal
4. **Prote√ß√µes**: O admin principal (definido em `MAIN_ADMIN`) n√£o pode ser modificado por outros admins

## üîç C√≥digos de Status HTTP

- `200`: Sucesso
- `401`: N√£o autorizado (token inv√°lido)
- `403`: Acesso negado (n√£o √© admin ou tentativa de modificar admin principal)
- `404`: Recurso n√£o encontrado
- `409`: Conflito (ex: usu√°rio j√° existe)
- `429`: Muitas tentativas (rate limiting)
- `500`: Erro interno do servidor

---

Esta documenta√ß√£o cobre as principais funcionalidades do m√≥dulo de administra√ß√£o. Para quest√µes espec√≠ficas ou problemas t√©cnicos, consulte os logs do sistema ou entre em contato com a equipe de desenvolvimento.